{"path":"pdf/金融风险管理/6 资产组合的var计算.pdf","text":"资产组合的VaR计算 主讲教师：刘烨 南京大学工程管理学院 Financial Risk Management 第6章 1 目录 1. VaR的计算方法分类 2. 基于方差-协方差法的VaR计算 3. 基于历史模拟法的VaR计算 4. 基于Monte Carlo模拟法的VaR计算 5. 基于Delta正态法的VaR计算和基于Delta-Gamma正态法的VaR计算 1. VaR的计算方法分类 • 回顾单资产VaR的计算：假设初始价值为 P0 ，日投资收益 率 R 服从正态分布N(μ, σ) 。根据VaR的定义，可求得在 置信度 c 下的日 VaRA为： • 如何计算组合的VaR？根据VaR的定义，关键要先估计资 产组合未来损益ΔP的概率分布 其中， 是置信水平。 • VaR计算方法的分类是根据确定ΔP 分布的方法划分的。损 益ΔP的概率分布 c 1- Pr ( )c ob P VaR= ∆ <− 1. VaR的计算方法分类 • 回顾单资产VaR的计算：假设初始价值为 P0 ，日投资收益 率 R 服从正态分布N(μ, σ) 。根据VaR的定义，可求得在 置信度 c 下的日 VaRA为： • 如何计算组合的VaR？根据VaR的定义，关键要先估计资 产组合未来损益ΔP的概率分布 其中， 是置信水平。 • VaR计算方法的分类是根据确定ΔP 分布的方法划分的。 1- Pr ( )c ob P VaR= ∆ <− c 1. VaR的计算方法分类 • 回顾单资产VaR的计算：假设初始价值为 P0 ，日投资收益 率 R 服从正态分布N(μ, σ) 。根据VaR的定义，可求得在 置信度 c 下的日 VaRA为： • 如何计算组合的VaR？根据VaR的定义，关键要先估计资 产组合未来损益ΔP的概率分布 其中， 是置信水平。 • VaR计算方法的分类是根据确定ΔP 分布的方法划分的。 1- Pr ( )c ob P VaR= ∆ <− c 1. VaR的计算方法分类 VaR的计算方法(ΔP分布 确定方法) 收益率映射估值法 基于方差-协方差法的 VaR计算 风险因子映射估值法 风险因子映射估值模拟法 （全局法） 历史模拟法 蒙特卡洛模拟法 风险因子映射估值分析法 （局部法） 基于Delta、Gamma等 灵敏度指标的方法 0P PR∆= ⋅ 1. VaR的计算方法分类 VaR的计算方法(ΔP分 布确定方法) 收益率映射估值法 基于方差-协方差法的 VaR 风险因子映射估值法 风险因子映射估值模 拟法（全局法） 历史模拟法 蒙特卡洛模拟法 风险因子映射估值分 析法（局部法） 基于Delta、Gamma 等灵敏度指标的方法 1. VaR的计算方法分类 VaR的计算方法(ΔP分 布确定方法) 收益率映射估值法 基于方差-协方差法的 VaR 风险因子映射估值法 风险因子映射估值模 拟法（全局法） 历史模拟法 蒙特卡洛模拟法 风险因子映射估值分 析法（局部法） 基于Delta、Gamma 等灵敏度指标的方法 模拟风险因子未来变化情景，将变化情景代 入定价公式，从而得到组合损益ΔP的分布 11 1 2 2 11 2( , ,..., ) ( , ,..., ) nn nP Pf f f f f f Pf f f∆ = +∆ +∆ +∆ −1. VaR的计算方法分类 VaR的计算方法(ΔP分 布确定方法) 收益率映射估值法 基于方差-协方差的 VaR计算 风险因子映射估值法 风险因子映射估值模 拟法（全局法） 历史模拟法 蒙特卡洛模拟法 风险因子映射估值分 析法（局部法） 基于Delta、Gamma 等灵敏度指标的方法 应用灵敏度系数近似估计组合的价值变化， 然后给出组合的损益分布 12 12 ... n n PP P Pf f f ff f ∂∂ ∂ ∆ ≈ ∆+ ∆ + + ∆ ∂∂ ∂ 1. VaR的计算方法分类 VaR的计算方法(ΔP分 布确定方法) 收益率映射估值法 基于方差-协方差的 VaR计算 风险因子映射估值法 风险因子映射估值模 拟法（全局法） 历史模拟法 蒙特卡洛模拟法 风险因子映射估值分 析法（局部法） 基于Delta、Gamma 等灵敏度指标的方法 应用灵敏度系数近似估计组合的价值变化， 然后给出组合的损益分布 12 12 ... n n PP P Pf f f ff f ∂∂ ∂ ∆ ≈ ∆+ ∆ + + ∆ ∂∂ ∂ 1.VaR的计算——计算方法分类 VaR的计算方法(ΔP分 布确定方法) 收益率映射估值法 基于方差-协方差法的 VaR 风险因子映射估值法 风险因子映射估值模 拟法 历史模拟法 蒙特卡洛模拟法 风险因子映射估值分 析法 基于Delta、Gamma 等灵敏度指标的方法 非参数法（历史模拟 法） 参数法（其余三类方 法） 目录 1. VaR的计算方法分类 2. 基于方差-协方差法的VaR计算 3. 基于历史模拟法的VaR计算 4. 基于Monte Carlo模拟法的VaR计算 5. 基于Delta正态法的VaR计算和基于Delta-Gamma正态法的VaR计算 2. 基于方差-协方差法的VaR计算 多资产且每个资产的收益率服从正态分布 假设组合由 n 种资产构成，组合的初始价值为 ，组合中n 种资产的 初始价值分别为 。n 种资产的日收益率向量 服从n 维正态分布 ，则该组合在置信度c下的 日VaRA为： 其中， 0P 0,1 0,2 0,, ,, nPP P (, )N µ Σ 12, ,, )nRR R( 1 0 ( () )A AAVaR P c σµ −= Φ− 基于方差-协方差法的VaR计算 证明：资产𝑖𝑖的日损益∆𝑃𝑃𝐴𝐴,𝑖𝑖= 𝑃𝑃0,𝑖𝑖𝑅𝑅𝑖𝑖，组合的日损益为∆𝑃𝑃𝐴𝐴= ∑𝑖𝑖=1 𝑛𝑛 ∆𝑃𝑃𝐴𝐴,𝑖𝑖= ∑𝑖𝑖=1 𝑛𝑛 𝑃𝑃0,𝑖𝑖𝑅𝑅𝑖𝑖 于是，组合的日损益率为： 𝑅𝑅 = ∆𝑃𝑃𝐴𝐴 𝑃𝑃0 = 1 𝑃𝑃0 � 𝑖𝑖=1 𝑛𝑛 ∆𝑃𝑃𝐴𝐴,𝑖𝑖 = 1 𝑃𝑃0 � 𝑖𝑖=1 𝑛𝑛 𝑃𝑃0,𝑖𝑖𝑅𝑅𝑖𝑖 𝜇𝜇𝐴𝐴 = 1 𝑃𝑃0 � 𝑖𝑖=1 𝑛𝑛 𝑃𝑃0,𝑖𝑖𝜇𝜇𝑖𝑖 𝜎𝜎𝐴𝐴 2= 𝑉𝑉𝑉𝑉𝑉𝑉 𝑅𝑅 = 1 𝑃𝑃0 2� 𝑖𝑖=1 𝑛𝑛 � 𝑗𝑗=1 𝑛𝑛 𝑃𝑃0,𝑖𝑖𝑃𝑃0,𝑗𝑗𝜌𝜌𝑖𝑖𝑗𝑗𝜎𝜎𝑖𝑖𝜎𝜎𝑗𝑗 𝑉𝑉𝑉𝑉𝑅𝑅𝐴𝐴 = 𝑃𝑃0(𝜙𝜙−1 𝑐𝑐 𝜎𝜎𝐴𝐴 − 𝜇𝜇𝐴𝐴) 根据正态分布的可加性，得𝑅𝑅服从正态分布𝑁𝑁(𝜇𝜇𝐴𝐴, 𝜎𝜎𝐴𝐴 2)，其中： 可求得： 2. 基于方差-协方差法的VaR计算 多资产且每个资产的收益率服从正态分布 • 假设组合由 n 种资产构成，组合的初始价值为 ，组合中n 种资产的 初始价值分别为 。n 种资产的日收益率向量 服从n 维正态分布 ，则该组合在置信度c下的日VaRA为： 其中， 是权重。 0P 0,1 0,2 0,, ,, nPP P (, )N µ Σ 12, ,, )nRR R( 1 n i i iA wµµ = =∑ 2 22 ,, 1 11 2 nn n nn A i j ij i j i i i j ij i j i j=1 i i j i ww w wwσ ρ σσ σ ρ σσ = = = > += =∑∑ ∑ ∑∑ 0, 0 i i P w P = 1 0 ( () )A AAVaR P c σµ −= Φ− Q：可以不计算协方差矩阵吗？ 收集组合价值历史数据，计 算组合收益率R，直接估计R 的分布？ 2. 基于方差-协方差法的VaR计算 多资产且每个资产的收益率服从正态分布 • 假设组合由 n 种资产构成，组合的初始价值为 ，组合中n 种资产的 初始价值分别为 。n 种资产的日收益率向量 服从n 维正态分布 ，则该组合在置信度c下的日VaRA为： 其中， 是权重。 0P 0,1 0,2 0,, ,, nPP P (, )N µ Σ 12, ,, )nRR R( 1 n i i iA wµµ = =∑ 2 22 ,, 1 11 2 nn n nn A i j ij i j i i i j ij i j i j=1 i i j i ww w wwσ ρ σσ σ ρ σσ = = = > += =∑∑ ∑ ∑∑ 0, 0 i i P w P = 1 0 ( () )A AAVaR P c σµ −= Φ− 有用结论：资产A和B的收益 率均值均为0，两个资产收益 率的相关系数为0，则 组合VaR的平方=资产A的VaR 的平方+资产B的VaR的平方 2. 基于方差-协方差法的VaR计算 • FRM习题：考虑含两种货币——加拿大元（CAD）和欧元（EUR）的投资组 合。这两种货币不相关，且相对美元的汇率各自有5%和12%的波动性。该投 资组合有200万美元投资于CAD，100万美元投资于EUR。计算95%置信水平 下的组合VaR。 • 收益是什么？ • 收益不确定性来自汇率变动的不确定性，已知条件： 22 1 0.05σ = 22 2 0.12σ = 0 0,1 0,2 200 100 300PPP += + == 1 0,1 0 2 /3PwP == 2 0,2 0 1/ 3PwP == 12 0ρ = 12 0=µµ = 2. 基于方差-协方差法的VaR计算 • FRM习题：考虑含两种货币——加拿大元（CAD）和欧元（EUR）的投资组合。这 两种货币不相关，且相对美元的汇率各自有5%和12%的波动性。该投资组合有200 万美元投资于CAD，100万美元投资于EUR。计算95%置信水平下的组合VaR。 • 收益不确定性来自汇率变动的不确定性，已知条件： • 计算组合的方差： • 计算VaR： • 万美元 22 1 0.05σ = 22 2 0.12σ = 0 0,1 0,2 200 100 300PPP += + == 1 0,1 0 2 /3PwP == 2 0,2 0 1/ 3PwP == 12 0ρ = 22 22 2 2 2 2 11 22 1 2 12 1 22 ( ) 0.05 (1 3) 0.12A w w + w w = 2/3 =5.21%σ σ σ ρ σσ+ ⋅ + ⋅= 1 0 (0.95) 300 1.65 0.0521 25.7738AAVaR P =σ −= ⋅Φ ⋅ = ⋅⋅ 12 0=µµ = 2. 基于方差-协方差法的VaR计算 实验5：从图书馆CCER数据库任意下载三只股票的价格数据，时间区间为2016.1.1- 2020.03.31。假设你每只持有100股，今日为2019.12.30，明日卖出，计算： （1）单资产日VaR（在异方差假设下用EWMA估计收益率的标准差，然后计算VaR）； （2）组合日VaR（在异方差假设下用EWMA估计组合协方差，然后计算VaR）； （3）组合日VaR（在同方差假设下计算VaR）； （4）并做回测。 • 数据时间范围：2016年1月1日-2020年3月31日； • 估计期：2016年1月1日-2019年12月30日； • 回测期：2019年12月31日-2020年3月31日 代码示例 2. 基于方差-协方差法的VaR计算 实验5：从图书馆CCER数据库任意下载三只股票的价格数据，时间区间为2016.1.1- 2020.03.31。假设你每只持有100股，今日为2019.12.30，明日卖出，计算： （1）单资产日VaR（在异方差假设下用EWMA估计收益率的标准差，然后计算VaR）； （2）组合日VaR（在异方差假设下用EWMA估计组合协方差，然后计算VaR）； （3）组合日VaR（在同方差假设下计算VaR）； （4）并做回测。 • 数据时间范围：2016年1月1日-2020年3月31日； • 估计期：2016年1月1日-2019年12月30日； • 回测期：2019年12月31日-2020年3月31日 如何回测？（如何识别例外） 目录 1. VaR的计算方法分类 2. 基于方差-协方差法的VaR计算 3. 基于历史模拟法的VaR计算 • 引子 • 基本原理和实施步骤 • 举例 • 精确度 • 修正 4. 基于Monte Carlo模拟法的VaR计算 5. 基于Delta正态法的VaR计算和基于Delta-Gamma正态法的VaR计算 3. 基于历史模拟法的VaR计算——引子 历史很重要：历史是对将来的指导 以铜为鉴，可以正衣冠；以人为鉴，可以知得失； 以史为鉴，可以知兴替。 —魏徵 读史使人明智。 —培根 历史是什么：是过去传到将来的回声，是将来对 过去的反应。 —雨果 历史不会重复自己，但会押着同样的韵脚。 —马克吐温 3. 基于历史模拟法的VaR计算——引子 基于历史模拟法的VaR计算： ∆P = ∆P 𝑓𝑓1, 𝑓𝑓2, … , 𝑓𝑓𝑛𝑛 由过去几年的数据得出风险因子未来的概率分布， 进而得到组合损益 ∆P 的分布。 3. 基于历史模拟法的VaR计算 ——基本原理和实施步骤 实施步骤： 1 • 根据定价公式（证券组合价值与风险因子之间的映射关系），识别风险因子； 2 • 将各个风险因子在过去某一时期上的变化分布或变化情景准确刻画出来，作 为该风险因子未来的变化分布或变化情景； 3 • 在上述基础上借助定价公式，模拟出资产组合未来可能的损益分布； 4 • 计算给定置信度c下的VaR； 5 • VaR回测。 ∆P = P 𝑓𝑓1+ ∆𝑓𝑓1, 𝑓𝑓2+ ∆𝑓𝑓2, … , 𝑓𝑓𝑛𝑛 + ∆𝑓𝑓𝑛𝑛 − P 𝑓𝑓1, 𝑓𝑓2, … , 𝑓𝑓𝑛𝑛 3. 基于历史模拟法的VaR计算——举例 举例：投资者在2008年9月25日持有一个价值为1000万美元的投资组合，组合中有四个股票指 数；美国道琼斯工业指数（DJIA），英国FTSE100指数，法国CAC40指数，日本的Nikkei225指 数。每个指数在2008年9月25日的取值如下表。请计算在置信度为99%的情况下该投资组合的日 VaR。 表1 用来演示VaR计算过程的投资组合（单位：千美元） 指数 DJIA FTSE100 CAC40 Nikkei225 总计 组合价值 4000 3000 1000 2000 10000 3. 基于历史模拟法的VaR计算——举例 第一步，确定风险因子。这里的投资组合用的是四个不同国家的指数， 就将这四个指数作为风险 因子。 第二步，收集过去501天（2008年9月25日及之前的501个交易日）这四个指数的收盘价历史数 据。见表2。 表2 采用历史模拟法计算VaR所需的股票指数数据（以美元计） 天数 日期 DJLA FTSE100 CAC40 Nikkei225 0 2006.08.07 11219.38 11131.84 6373.89 131.77 1 2006.08.08 11173.59 11096.28 6378.16 134.38 2 2006.08.09 11076.18 11185.35 6474.04 135.94 3 2006.08.10 11124.37 11016.71 6357.49 135.44 …… …… …… …… …… …… 499 2008.09.24 10825.17 9438.58 6033.93 114.26 500 2008.09.25 11022.06 9599.90 6200.40 112.82 3. 基于历史模拟法的VaR计算——举例 第一步，确定风险因子。就将这四个指数作为其风险因子。 第二步，收集过去501天（2008年9月25日及之前的501个交易日）这四个指数的收盘价。见表2。 第三步，计算这四个指数过去的500种不同变化情形。见下图。 表2 采用历史模拟法计算VaR所需的股票指数数据（以美元计） 天数 日期 DJLA FTSE100 CAC40 Nikkei225 0 2006.08.07 11219.38 11131.84 6373.89 131.77 1 2006.08.08 11173.59 11096.28 6378.16 134.38 2 2006.08.09 11076.18 11185.35 6474.04 135.94 3 2006.08.10 11124.37 11016.71 6357.49 135.44 …… …… …… …… …… …… 499 2008.09.24 10825.17 9438.58 6033.93 114.26 500 2008.09.25 11022.06 9599.90 6200.40 112.82 1 2 3 0天 1天 2天 3天 500 （i-1）天 i天 第i种变化情形: vi/vi-1 实际就是(1+ ri） 500天 501天 3. 基于历史模拟法的VaR计算——举例 第一步，确定风险因子。就将这四个指数作为其风险因子。 第二步，收集过去501天（2008年9月25日及之前的501个交易日）这四个指数的收盘价。见表2。 第三步，计算这四个指数过去的500种不同变化情形。见下图。 第四步，计算这四个指数明天（2008年9月26日）500种不同情形的取值。见表3。 表2 采用历史模拟法计算VaR所需的股票指数数据（以美元计） 天数 日期 DJLA FTSE100 CAC40 Nikkei225 0 2006.08.07 11219.38 11131.84 6373.89 131.77 1 2006.08.08 11173.59 11096.28 6378.16 134.38 2 2006.08.09 11076.18 11185.35 6474.04 135.94 3 2006.08.10 11124.37 11016.71 6357.49 135.44 …… …… …… …… …… …… 499 2008.09.24 10825.17 9438.58 6033.93 114.26 500 2008.09.25 11022.06 9599.90 6200.40 112.82 1 2 3 0天 1天 2天 3天 500 （i-1）天 i天 第i种变化情形: vi/vi-1 实际就是(1+ ri） 500天 501天 市场变量（指数收盘价）在明 天所对应的第i个情景为 𝑉𝑉𝑛𝑛 ∗(𝑉𝑉𝑖𝑖/𝑉𝑉𝑖𝑖−1) 其中，𝑉𝑉𝑛𝑛为今天（第n天）的 收盘价 3. 基于历史模拟法的VaR计算——举例 第一步，确定风险因子。就将这四个指数作为其风险因子。 第二步，收集过去501天（2008年9月25日及之前的501个交易日）这四个指数的收盘价。见表2。 第三步，计算这四个指数过去的500种不同变化情形。见下图。 第四步，计算这四个指数明天（2008年9月26日）500种不同情形的取值。见表3。 表3 由表2产生的2008年9月26日的股票指数不同情景 情形 编号 DJIA FTSE100 CAC40 Nikkei225 组合价值 （千美元） 损失 （千美元） 1 10977.08 9569.23 6204.55 115.05 10014.334 -14.334 2 10925.97 9676.96 6293.60 114.13 10027.481 -27.481 …… …… …… …… …… …… …… 499 10831.43 9383.49 6051.94 113.85 9857.465 142.535 500 11222.53 9763.97 6371.45 111.40 10126.439 -126.439 𝑉𝑉𝑛𝑛 ∗(𝑉𝑉𝑖𝑖/𝑉𝑉𝑖𝑖−1) DJIA在情形1下的数值为： 11022.06X 11173.59 11219.38 =10977.08。 表2 采用历史模拟法计算VaR所需的股票指数数据（以美元计） 天数 日期 DJLA FTSE100 CAC40 Nikkei225 0 2006.08.07 11219.38 11131.84 6373.89 131.77 1 2006.08.08 11173.59 11096.28 6378.16 134.38 2 2006.08.09 11076.18 11185.35 6474.04 135.94 3 2006.08.10 11124.37 11016.71 6357.49 135.44 …… …… …… …… …… …… 499 2008.09.24 10825.17 9438.58 6033.93 114.26 500 2008.09.25 11022.06 9599.90 6200.40 112.82 3. 基于历史模拟法的VaR计算——举例 第一步，确定风险因子。就将这四个指数作为其风险因子。 第二步，收集过去501天（2008年9月25日及之前的501个交易日）这四个指数的收盘价。见表2。 第三步，计算这四个指数过去的500种不同变化情形。见下图。 第四步，计算这四个指数明天（2008年9月26日）500种不同情形的取值。见表3。 第五步，计算该投资组合明天（2008年9月26日）500种不同情形的损失值。 表3 由表2产生的2008年9月26日的股票指数不同情景 情形编号 DJIA FTSE100 CAC40 Nikkei225 组合价值 （千美元） 损失 （千美元） 1 10977.08 9569.23 6204.55 115.05 10014.33 4 -14.334 2 10925.97 9676.96 6293.60 114.13 10027.48 1 -27.481 …… …… …… …… …… …… …… 499 10831.43 9383.49 6051.94 113.85 9857.465 142.535 500 11222.53 5300.42 4342.14 11899.00 10141.82 6 -141.826 表2 采用历史模拟法计算VaR所需的股票指数数据（以美元计） 天数 日期 DJLA FTSE100 CAC40 Nikkei225 0 2006.08.07 11219.38 11131.84 6373.89 131.77 1 2006.08.08 11173.59 11096.28 6378.16 134.38 2 2006.08.09 11076.18 11185.35 6474.04 135.94 3 2006.08.10 11124.37 11016.71 6357.49 135.44 …… …… …… …… …… …… 499 2008.09.24 10825.17 9438.58 6033.93 114.26 500 2008.09.25 11022.06 9599.90 6200.40 112.82 在情形1中，2008年9月26日该投资组合的收益为 ： 4000X10977.08 11022.06 +3000X 9569.23 9599.90 +1000X 6204.55 6200.40 +2000X 115.05 112.82 =10014.334（千美元） 原来资产为10000千美元，所以其损失值为10014.334-10000=14.334千美元 第一步，确定风险因子。就将这四个指数作为其风险因子。 第二步，收集过去501天（2008年9月25日及之前的501个交易日）这四个指数的收盘价。见表2。 第三步，计算这四个指数过去的500种不同变化情形。见下图。 第四步，计算这四个指数明天（2008年9月26日）500种不同情形的取值。见表3。 第五步，计算该投资组合明天（2008年9月26日）500种不同情形的损失值。见表4。 第六步，将不同情形下的损失根据大小排序，再计算对应的VaR。见表5。 第七步，VaR精确度评估。 情形编号 损失数量（单位：千美元） 494 477.841 339 345.435 349 282.204 329 277.041 487 见注释 253.385 131 217.974 …… …… 如果是求10天展望期以及99%置信区间的VaR， 那么其值等于 10乘以1天展望期及99%置信区 间的VaR。 即10天的VaR= 10 X253.385=801.274（千美 元） 3. 基于历史模拟法的VaR计算——举例 第一步，确定风险因子。就将这四个指数作为其风险因子。 第二步，收集过去501天（2008年9月25日及之前的501个交易日）这四个指数的收盘价。见表2。 第三步，计算这四个指数过去的500种不同变化情形。见下图。 第四步，计算这四个指数明天（2008年9月26日）500种不同情形的取值。见表3。 第五步，计算该投资组合明天（2008年9月26日）500种不同情形的损失值。见表4。 第六步，将不同情形下的损失根据大小排序，再计算对应的VaR。见表5。 第七步，VaR回测。 3. 基于历史模拟法的VaR计算—— Bootstrap抽样（自助抽样） • 采用Bootstrap法计算给定置信水平c下的VaR： • 从过去样本中随机抽样500次（允许放回的抽样），每次得到VaR的一个 估计值； • 抽样1000次，得到VaR的1000个估计值； • 将这1000个VaR估计值由大到小排序； • 得到VaR的区间估计：比如，95%置信区间为 [左边2.5%分位数, 右边97.5%分位数] • 置信区间提供了VaR的区间估计，可用于评估估计的精确度。 3. 基于历史模拟法的VaR计算——修正 情形编号 损失（以1000计） 权重 累计权重 494 477.841 0.00528 0.00528 339 345.435 0.00243 0.00771 329 282.204 0.00231 0.01002 349 277.041 0.00255 0.01258 487 253.385 0.00510 0.01798 …… …… …… …… 时间加权历 史模拟法 标准历史模 拟法 根据前面记号，第n天是今天，第i种情形对应第i天观测值，i越小时间越久 3. 基于历史模拟法的VaR计算——修正 1 11 1 1 ( )/i ii n i nn i v vv vv v σσ− −+ + − +− = 根据第i天的波动率相对大 小赋权， 相对明天预测的波动率越大， 权重越小 滤去了大的波动，滤波历史 模拟法 目录 1. VaR的计算方法分类 2. 基于方差-协方差法的VaR计算 3. 基于历史模拟法的VaR计算 4. 基于Monte Carlo模拟法的VaR计算 • Monte Carlo模拟法的产生和发展 • Monte Carlo模拟法的基本思想和实施步骤 • 基于Monte Carlo模拟的VaR计算举例 5. 基于Delta正态法的VaR计算和基于Delta-Gamma正态法的VaR计算 Monte Carlo模拟法源于美国在第二次世界大战期间研制原子弹的“曼哈顿计划“。当时需要计 算中子进入反应堆屏障的随机性运动，但无法获得实际数据； 四位科学家 Stanislaw Marcin Ulam, Enrico Fermi, John von Neumann 和 Nicholas Metropolis提出解决办法：建立随机模型，产生随机数。 这种方法类似于轮盘赌的随机旋转，冯•诺伊曼（Von Neumann）借用世界著名的赌城—— Monte Carlo来为此方法命名。 4. Monte Carlo模拟法的产生和发展4. Monte Carlo模拟法的产生和发展 • Case 1: 单变量的Monte Carlo模拟（以股票为例）。以几何布朗运动作为描 述股票价格未来走势的随机模型，通过随机抽样模拟出股票价格未来变化的 一条样本轨道或路径。 (1) 目标：现在t，期末T，模拟 (2) 几何布朗运动： (3) 确定股票初始价格 ，并用历史数据估计出参数 μ 和σ； (4) 利用计算机生成 个相互独立的标准正态随机数 ，代入上式递推得 到股价的时间序列 ，得到股票价格的一条样本轨道； (5) 重复得到N 条样本轨道，及股价的变化分布。 39 4. Monte Carlo模拟法的基本原理和实施步骤 ( 1)t i t t it t it t itS S S tS tµ σε+ + ∆ +∆ +∆ +∆− = ∆ + ∆ ( 1)t i tS ++ ∆ iε tS TS /Tt∆ 4. Monte Carlo模拟法的基本原理和实施步骤 • 以股票为例，介绍单变量的Monte Carlo模拟：以几何布朗运动作为描述股 票价格未来走势的随机模型，通过随机抽样模拟出股票价格未来变化的一条 样本轨道或路径。 4. Monte Carlo模拟法的基本原理和实施步骤 Case 2：多变量的Monte Carlo模拟。假设资产组合价值受 m 个风险因子 Sj 的 影响， Sj 仍服从几何布朗运动，j = 1，2，…，m。 Case 2.1：风险因子不相关 • 如果 m 个风险因子不相关，那么按照单变量Monte Carlo模拟的步骤和方法 分别独立地对每个风险因子进行模拟即可。 Case 2.2：风险因子相关 4. Monte Carlo模拟法的基本原理和实施步骤 Case 2：多变量的Monte Carlo模拟。假设资产组合价值受 m 个风险因子 Sj 的 影响， Sj 仍服从几何布朗运动，j = 1，2，…，m。 Case 2.2：风险因子相关。基于Cholesky因子分解法的多变量Monte Carlo模拟。 • 以 m = 2 为例，假设二维标准正态随机向量 均值为0，协方差矩阵为R= • 根据Cholesky因子分解法，可以将R表示为R=TT’，其中T是下三角矩阵： • 为二维相互独立的标准正态随机变量，构造 ，新随机向量 与 同均值同方差，并且同样为正态随机向量。 1 1 ρ ρ    2 11 11 12' 11 11 12 2 2 12 22 22 11 12 12 22 01 01 a a a a aa R TT a a a aa a a ρ ρ      = = = =     +      11 1a = 11 12aa ρ= 2 2 12 22 1aa+= ξ ε Tηε= ξη 4. Monte Carlo模拟法的基本原理和实施步骤 Case 2：多变量的Monte Carlo模拟。假设资产组合价值受 m 个风险因子 Sj 的 影响， Sj 仍服从几何布朗运动，j = 1，2，…，m。 Case 2.2：风险因子相关。基于Cholesky因子分解法的多变量Monte Carlo模拟。 • 以 m = 2 为例，假设二维正态随机向量 均值为0，协方差矩阵为R= • 根据Cholesky因子分解法，可以将R表示为R=TT’，其中T是下三角矩阵： • 为二维相互独立的标准正态随机变量，构造 ，新随机向量 与 同均值同方差，并且同样为正态随机向量。 2 1 12 2 21 2 cov cov σ σ    22 11 11 12'1 12 11 11 12 2 22 12 22 2221 2 11 12 12 22 0cov 0cov a a a a aa R TT aa a aa a a σ σ       = = = =      +      22 11 1a σ= 11 12 12covaa = 22 2 12 22 2aa σ+ = ξ ε Tηε= ξη 举例：假设某美国公司于1998年12月31日持有一份三个月后到期、以支付16.5百万美元收 到10百万英镑的远期合约。用Monte Carlo模拟法计算这家美国公司于1998年12月31日持 有该合约在c=95%置信度下的日VaR值。 定义以下符号：  S ：以美元表示的英镑的即期价格；  K ：货币远期合约中的约定价格，K=1.65（美元兑英镑）；  V ：远期合约的市场价值；  r ：用年化的百分率表示的3个月的美元利率；  r*：用年化的百分率表示的3个月的英镑利率；  τ ：合约的到期期限，τ=92/365年；  ：3个月的美元折现因子；  ：3个月的英镑折现因子。 44 4.基于Delta-Normal法的VaR计算（举例） 1 (1 )Prτ= + **1 (1 )Pr τ= + • 第一步确定风险因子，分别为即期汇率S、美元折现因子P以及英镑折现因子 P*；再建立远期合约的市场价值与上述市场风险因子之间的函数表达式，即： • 风险因子S、 P、 P*存在相关性，假设都服从几何布朗运动： 45 4. 基于Monte Carlo模拟法的VaR计算（举例） KPSP r K r Sf −= + − + = * * 1 1 1 1 ττ ( 1) 3 33 t i t t i t t i t P P tt P µ σξ + + ∆ + ∆ + ∆ − = ∆+ ∆ ** ( 1) 2 22* t i t t i t t i t P P tt P µ σξ + + ∆ + ∆ + ∆ − = ∆+ ∆ 11 2 2 3 3=( , , )ξ σξ σ ξ σ ξ ( 1) 1 11 t i t t i t t i t SS t t S µ σξ + + ∆ + ∆ + ∆ − = ∆+ ∆ 三维正态随机向量： • 第一步确定风险因子，分别为即期汇率S、美元折现因子P以及英镑折现因子 P*；再建立远期合约的市场价值与上述市场风险因子之间的函数表达式，即： • 风险因子S、 P、 P*存在相关性，假设都服从几何布朗运动： 46 4. 基于Monte Carlo模拟法的VaR计算（举例） KPSP r K r Sf −= + − + = * * 1 1 1 1 ττ ( 1) 3 33 t i t t i t t i t P P tt P µ σξ + + ∆ + ∆ + ∆ − = ∆+ ∆ ** ( 1) 2 22* t i t t i t t i t P P tt P µ σξ + + ∆ + ∆ + ∆ − = ∆+ ∆ 11 2 2 3 3=( , , )ξ σξ σ ξ σ ξ ( 1) 1 11 t i t t i t t i t SS t t S µ σξ + + ∆ + ∆ + ∆ − = ∆+ ∆ 三维正态随机向量： 如何模拟得到 的随机数？ 11 2 2 3 3=( , , )ξ σξ σ ξ σ ξ • 第二步，选取汇率S和利率r、r*从1998年8月10日至拟考察日期12月31 日之间101个交易日的历史数据（见下表），计算得到风险因子ΔS/S、 ΔP*/P*、 ΔP/P的样本。 47 4. 基于Monte Carlo模拟法的VaR计算（举例） t 日期（1998年） r（%/年） r*（%/年） S（美元/英镑） 0 12月31日 4.9375 5.9688 1.6637 －1 12月30日 4.968 6.967 1.6108 －2 12月29日 5.007 6.989 1.6087 －3 12月28日 4.994 7.016 1.60855 … … … … … 第三步 以历史数据估计协方差矩阵和均值向量 协方差矩阵Σ ΔS/S ΔP*/P* ΔP/P ΔS/S 1.17E-05 7.88E-07 2.90E-08 ΔP*/P* 7.88E-07 6.76E-08 8.83E-10 ΔP/P 2.90E-08 8.83E-10 7.96E-09 均值向量（漂移率） ΔS/S ΔP*/P* ΔP/P 0 0 0 48 4. 基于Monte Carlo模拟法的VaR计算（举例） 第四步 协方差矩阵Σ的Cholesky分解 a 0.003420526 下三角矩阵T b 0.000230374 c 0.000120532 d 8.48E-06 e -8.88E-06 f 8.84E-05 49 00 0 a T bc de f    =     4. 基于Monte Carlo模拟法的VaR计算（举例） 第五步 利用Monte Carlo模拟方法生成三个风险因子的样本 第六、第七步 估值并计算VaR 随机数 风险因子未来变化的可能取值 远期合约价值和损益的可能值（美元） S（美元/英镑） P* P f T Δf 1 -2.50 1.47 -0.42 1.6774 0.9850 0.9877 224123.15 130542.15 2 -2.12 0.16 -0.22 1.6757 0.9852 0.9877 211071.71 117490.71 3 -2.13 1.80 -0.51 1.6751 0.9850 0.9878 201620.22 108039.22 96 1.58 1.52 0.63 1.6541 0.9850 0.9877 -2942.62 -96523.62 99 2.18 -1.44 -1.03 1.6519 0.9853 0.9878 -22094.71 -115675.71 100 2.42 0.18 0.41 1.6498 0.9852 0.9877 -43117.06 -136698.06 50 4. 基于Monte Carlo模拟法的VaR计算（举例） 1ε 2ε 3ε 生成ε的随机数，根据η＝Tε得到η的样本，可视作 的样本，再用几何布 朗运动公式算出S、P、P*，代入定价公式计算合约价值fT以及损益Δf： 4. 基于Monte Carlo模拟法的VaR计算（举例） • 第一步，识别风险因子变量Sj，其中j = 1，2，…，m；建立资产组合价值V与风险因子变量 Sj 之间的映射关系 ，不妨设为: • 第二步，对风险因子未来变化进行随机模拟，得到各个风险因子变量 Sj 未来变化的一条样本 轨道，并计算出 ，其中 j = 1，2，…，m • 第三步，利用第一步给出的公式，计算组合价值 与 • 第四步，不断重复第三步和第四步N次，就可以得到资产组合损益分布 • 第五步，基于损益分布计算置信度 c 下的VaR (1) (2) ( ), ,......, N TT TVV V∆∆ ∆ 12(, , , )mV VS S S=  1, 2, ,( , ,, )T T T mTV VS S S=  ,, , ,, ,,jt jt t jt n t j TSS S S+∆ + ∆ = T TtV V V∆ = − 目录 1. VaR的计算方法分类 2. 基于方差-协方差法的VaR计算 3. 基于历史模拟法的VaR计算 4. 基于Monte Carlo模拟法的VaR计算 5. 基于Delta正态法的VaR计算和基于Delta-Gamma正态法的VaR计算 1. 基于Delta正态法的VaR计算（基本原理）：  资产组合的损益近似为  若风险因子 f =(f1，…，fn)’ 的收益率向量 r =(r1，…，rn)’ 服从正态分 布 ，则资产组合的收益率R= /P0 也近似地服从正态分布；  估计出组合收益率R= /P0 的均值和方差；  计算VaR： 53 5.基于Delta-Normal法的VaR计算 ,Σ(0 )N P∆ P∆ 1 0 ( () )PPVaR P c σµ −= ⋅Φ − 11 1 ( , ) (, ) = = nn n i i i ii ii ii ii i fPP P P Pt t f f Pt f f f f r f ff f= = = ∆∂∂ ∂ ∆ = + ∆ + ∆ − ≈ ∆ ⋅ ⋅ ⋅ ⋅ ∂∂ ∂∑∑ ∑ 2.基于Delta正态法的VaR计算（具体步骤）： (1) 识别风险因子变量，建立组合价值与风险因子之间的映射关系； (2) 估计风险因子收益率的均值向量、协方差矩阵； (3) 计算灵敏度系数Delta； (4) 估计组合收益率的分布(均值、方差)； (5) 计算VaR。 54 5.基于Delta-Normal法的VaR计算 11 ( , ) (, ) = nn i ii iiii PP P Pt t f f Pt f f f r ff= = ∂∂ ∆ = + ∆ + ∆ − ≈ ∆ ⋅ ⋅ ∂∂∑∑ 2. 具体步骤： (1) 识别风险因子变量，建立组合价值与风险因子之间的映射关系； (2) 估计风险因子收益率的均值向量、协方差矩阵； 其中，Δt 表示相邻两期历史数据的时间间隔，也是计算资产组合VaR的持有期；T 表示样本期期数；假设风险因子收益率的均值为0。 (3) 计算灵敏度系数Delta； (4) 估计组合收益率的分布(均值、方差)； (5) 计算VaR。 55 5.基于Delta-Normal法的VaR计算 , , 1 1 1 T ij i tt j tt t rr T σ − ⋅∆ − ⋅∆ = = − ∑ 2. 具体步骤： (1) 识别风险因子变量，建立组合价值与风险因子之间的映射关系； (2) 估计风险因子收益率的均值向量、协方差矩阵； (3) 计算灵敏度系数Delta； (4) 估计组合收益率的分布(均值、方差)； (5) 计算VaR。 56 5.基于Delta-Normal法的VaR计算 12 ( , , , )' n P P P P f f f ∂∂ ∂ ∇= ∂ ∂ ∂  2 ar( ) ar(( )' [ ( ) ]) ( )' [ ( ) ( )]P V P V P diag f r P diag f diag f Pσ = ∆ = ∇⋅ ⋅ = ∇ ⋅ ⋅Σ⋅ ∇ 2. 具体步骤： (1) 识别风险因子变量，建立组合价值与风险因子之间的映射关系； (2) 估计风险因子收益率的协方差矩阵； (3) 计算灵敏度系数Delta； (4) 估计组合收益率的分布(均值、方差)； (5) 计算VaR。 57 5.基于Delta-Normal法的VaR计算 1 0 () PVaR P c σ −= ⋅Φ1 0 ( () )PPVaR P c σµ −= ⋅Φ − 3. FRM习题：一位投资组合经理以每份6美元的价格购买了1000份执行价为100 美元的非派息股票看涨期权。当前股价为104美元，日收益波动率为1.89%，期 权delta为0.6。使用Delta-Normal方法计算VaR，该头寸的1天95% VaR的近似 值是多少？ A：USD 112 B：USD 1946 C：USD 3243 D：USD 5406 【解析】B • 期权的delta是0.6，则一份期权的VaR为： • 58 5.基于Delta-Normal法的VaR计算 oSVaR delta VaR= ⋅ 1 ( , ) (, ) n i i i P P Pt t f f Pt f f f= ∂ ∆ = +∆ +∆ − ≈ ∆ ∂∑ 3. FRM习题：一位投资组合经理以每份6美元的价格购买了1000份执行价为100 美元的非派息股票看涨期权。当前股价为104美元，日收益波动率为1.89%，期 权delta为0.6。使用Delta-Normal方法计算VaR，该头寸的1天95% VaR的近似 值是多少？ A：USD 112 B：USD 1946 C：USD 3243 D：USD 5406 【解析】B • 期权的delta是0.6，则一份期权的VaR为： • 标的股票： =104*1.65*1.89% = 3.24， • 因此，一份期权的VaR=0.6*3.24=1.946， 乘以1000得到整个头寸的VaR为 1946。 59 5.基于Delta-Normal法的VaR计算 oSVaR delta VaR= ⋅ VaR𝑠𝑠 = 𝑆𝑆0� Φ−1(𝑐𝑐)𝜎𝜎S 4. 举例：假设某美国公司于1998年12月31日持有一份三个月后到期、以支付16.5百万 美元买入10百万英镑的远期合约。用Delta-Normal模拟法计算这家美国公司于1998 年12月31日持有该合约在c=95%置信度下的日VaR值。 定义以下符号：  S ：以美元表示的英镑的即期价格；  K ：货币远期合约中的约定价格，K=1.65；  V ：远期合约的市场价值；  r ：用年化的百分率表示的3个月的美元利率；  r*：用年化的百分率表示的3个月的英镑利率；  τ ：合约的到期期限，τ=92/365年；  ：3个月的美元折现因子；  ：3个月的英镑折现因子。 60 5.基于Delta-Normal法的VaR计算（举例） 1 (1 )Prτ= + **1 (1 )Pr τ= + 5.基于Delta-Normal法的VaR计算（举例） • (1) 先写出购买1英镑的一个远期合约的市场价值和风险因子之间的函数关系 (2) 计算一个远期合约在未来一天内价值变化的一阶近似式 (3) 估计三个风险因子收益率 ΔS/S、ΔP*/P* 以及 ΔP/P 的协方差矩阵； (4) 计算组合价值对每个风险因子 ΔS/S、ΔP*/P* 以及 ΔP/P的Delta ； (5) 计算组合价值变化 ΔV 的均值、标准差； (6) 计算得到在95%的置信度下持有该远期合约的VaR为 $98,150.135 。 * * 11 11 V S K SP KP r rττ = −= − ++ * ** * * *() () ( ) SP P V P S S P K P SP SP KP SP P ∆ ∆ ∆ ∆ ≈ ∆+ ∆ − ∆ = + − 5.基于Delta-Normal法的VaR计算（举例） • (1) 先写出购买1英镑的一个远期合约的市场价值和风险因子之间的函数关系 (2) 计算一个远期合约在未来一天内价值变化的一阶近似式 (3) 估计三个风险因子收益率 ΔS/S、ΔP*/P* 以及 ΔP/P 的协方差矩阵； (4) 计算组合价值对每个风险因子 ΔS/S、ΔP*/P* 以及 ΔP/P的Delta ； (5) 计算组合价值变化 ΔV 的均值、标准差； (6) 计算得到在95%的置信度下持有该远期合约的VaR为 $98,150.135 。 * * 11 11 V S K SP KP r rττ = −= − ++ * ** * * *() () ( ) SP P V P S S P K P SP SP KP SP P ∆ ∆ ∆ ∆ ≈ ∆+ ∆ − ∆ = + − 5.基于Delta-Normal法的VaR计算（举例） (4) 计算组合价值对每个风险因子 ΔS/S、ΔP*/P* 以及 ΔP/P的Delta ； (5) 计算组合价值变化 ΔV 的均值、标准差； 风险因子收益 率协方差矩阵 ΔS/S ΔP*/P* ΔP/P ΔS/S 1.17E-05 7.88E-07 2.90E-08 ΔP*/P* 7.88E-07 6.76E-08 8.83E-10 ΔP/P 2.90E-08 8.83E-10 7.96E-09 购买1000万英镑 的风险因子暴露向量 （Delta） SP* SP* （-KP） 16392392.72 16392392.72 -16298811.5 组合损益的方差 3.56E+09 组合损益的标准差 59665.73556 VaR（95%置信度） * ** * * *() () ( ) SP P V P S S P K P SP SP KP SP P ∆ ∆ ∆ ∆ ≈ ∆+ ∆ − ∆ = + − 5.基于Delta-Normal法的VaR计算（举例） (6) 计算得到在95%的置信度下持有该远期组合的VaR为 $98,150.135 。 风险因子收益 率协方差矩阵 ΔS/S ΔP*/P* ΔP/P ΔS/S 1.17E-05 7.88E-07 2.90E-08 ΔP*/P* 7.88E-07 6.76E-08 8.83E-10 ΔP/P 2.90E-08 8.83E-10 7.96E-09 风险因子暴露向量 （Delta） SP* SP* （-KP） 16392392.72 16392392.72 -16298811.5 组合损益的方差 3.56E+09 组合损益的标准差 59665.73556 VaR（95%置信度） $98150.135 * ** * * *() () ( ) SP P V P S S P K P SP SP KP SP P ∆ ∆ ∆ ∆ ≈ ∆+ ∆ − ∆ = + − 4. Delta-正态方法评述 (1) 优点：  计算简单、操作方便；  当风险因子变化很小时，计算误差较小。 (2) 缺陷：  不能反映非线性风险；  多元正态分布假设不尽合理；  使用简单移动平均方法估计收益率协方差矩阵易导致预测结果失真;  历史数据长度对协方差估计的可靠性也会产生影响。 65 5.基于Delta-Normal法的VaR计算（举例） Delta-Gamma-正态法的基本原理：  采用资产组合价值的变化或损益 关于风险因子变化向量的二阶 Talyor展式作为 的近似；  仍假设风险因子的收益率服从正态分布；  仿照Delta-正态方法的实施步骤来进行。 66 5. 基于Delta-Gamma-Normal法的VaR计算 P∆ P∆ 2 1 11 1 2 n nn i i j i iji ij PP P x xx x xx= = = ∂∂ ∆ ≈ ∆ + ∆∆ ∂ ∂∂∑ ∑∑本章结束","libVersion":"0.2.4","langs":""}